/**
  ************************************************************************
  * @file    main.c
  * @author  fire
  * @version V1.0
  * @date    2018-xx-xx
  * @brief   ??FreeRTOS?????????????????????üž????
  *           ???FreeRTOS?????????????
  ************************************************************************
  * @attention
  *
  * ?????:??? i.MX RT ??? ??????
  * 
  * ????    :www.embedfire.com  
  * ???    :http://www.firebbs.cn
  * ???    :https://fire-stm32.taobao.com
  *
  ************************************************************************
  */
  
/*
*************************************************************************
*                             ??????????
*************************************************************************
*/
#include "FreeRTOS.h"
#include "task.h"

/*
*************************************************************************
*                              ??????
*************************************************************************
*/
portCHAR flag1;
portCHAR flag2;

extern List_t pxReadyTasksLists[ configMAX_PRIORITIES ];


/*
*************************************************************************
*                        ???????? & STACK 
*************************************************************************
*/
TaskHandle_t Task1_Handle;
#define TASK1_STACK_SIZE                    20
StackType_t Task1Stack[TASK1_STACK_SIZE];
TCB_t Task1TCB;

TaskHandle_t Task2_Handle;
#define TASK2_STACK_SIZE                    20
StackType_t Task2Stack[TASK2_STACK_SIZE];
TCB_t Task2TCB;


/*
*************************************************************************
*                               ???????? 
*************************************************************************
*/
void delay (uint32_t count);
void Task1_Entry( void *p_arg );
void Task2_Entry( void *p_arg );

/*
************************************************************************
*                                main????
************************************************************************
*/
/*
* ???????1???¨´?????????????—¨debug????? Ude Simulator
*           2????Target???????????Xtal(Mhz)??????25???????12??
*              ???25??????system_ARMCM3.c?§Ø????__SYSTEM_CLOCK??????????????????????
*/
int main(void)
{	
    /* ???????? */
	/* ?????????????????????????????????????????????????? */
    
    /* ????????????????§Ò?????????§Ò? */
    prvInitialiseTaskLists();
    
    /* ???????? */
    Task1_Handle = xTaskCreateStatic( (TaskFunction_t)Task1_Entry,   /* ??????? */
					                  (char *)"Task1",               /* ????????????????? */
					                  (uint32_t)TASK1_STACK_SIZE ,   /* ???????§³????¦Ë??? */
					                  (void *) NULL,                 /* ?????¦Â? */
					                  (StackType_t *)Task1Stack,     /* ??????????? */
					                  (TCB_t *)&Task1TCB );          /* ???????? */
    /* ????????????????§Ò? */                                 
    vListInsertEnd( &( pxReadyTasksLists[1] ), &( ((TCB_t *)(&Task1TCB))->xStateListItem ) );
                                
    Task2_Handle = xTaskCreateStatic( (TaskFunction_t)Task2_Entry,   /* ??????? */
					                  (char *)"Task2",               /* ????????????????? */
					                  (uint32_t)TASK2_STACK_SIZE ,   /* ???????§³????¦Ë??? */
					                  (void *) NULL,                 /* ?????¦Â? */
					                  (StackType_t *)Task2Stack,     /* ??????????? */
					                  (TCB_t *)&Task2TCB );          /* ???????? */
    /* ????????????????§Ò? */                                 
    vListInsertEnd( &( pxReadyTasksLists[2] ), &( ((TCB_t *)(&Task2TCB))->xStateListItem ) );
                                      
    /* ????????????????????????????????????? */
    vTaskStartScheduler();                                      
    
    for(;;)
	{
		/* ??????????????????? */
	}
}

/*
*************************************************************************
*                               ???????
*************************************************************************
*/
/* ??????? */
void delay (uint32_t count)
{
	for(; count!=0; count--);
}
/* ????1 */
void Task1_Entry( void *p_arg )
{
	for( ;; )
	{
		flag1 = 1;
		delay( 100 );		
		flag1 = 0;
		delay( 100 );
		
		/* ?????§Ý?????????????§Ý? */
        taskYIELD();
	}
}

/* ????2 */
void Task2_Entry( void *p_arg )
{
	for( ;; )
	{
		flag2 = 1;
		delay( 100 );		
		flag2 = 0;
		delay( 100 );
		
		/* ?????§Ý?????????????§Ý? */
        taskYIELD();
	}
}



























